\section{Applikationslaget}
I dette afsnit beskrives designet af applikationslaget. Applikationslaget er det lag af software i det samlede distribuerede system, som installeres eller afvikles hos brugeren. Applikationslaget er designet til at v칝re platformuafh칝ngigt, jf. systemets arkitektur. Derved er lagets model- og pr칝sentationslag designet til at v칝re portabelt, hvorimod view-laget er platformspecifikt. Nedenfor ses det overordnede lagdiagram for applikationslagets design.

\begin{figure}
	\centering
	\includegraphics[width=1.0\linewidth]{figs/design/application_layer}
	\caption{Lagdiagram applikationslagets softwarepakker}
	\label{fig:application_layer}
\end{figure}

Af diagrammet fremg친r det, at applikationslaget er opdelt i flere lag som f칮lge af model-view-presenter arkitekturen, beskrevet i afsnittet arkitektur. En del af applikationslagets model findes i en separat pakke under navnet Smartpool.Connection. Denne pakke indeholder model-klasser til kommunikation mellem klient-applikationerne og Smartpools businesss-logic server.

Som f칮lge af multi-lag arkitekturen kunne applikationslaget samt de platform-specifikke view-implementeringer designes, uafh칝ngigt af hinanden, s친 l칝nge interfaces blev specificeret undervejs i processen. Sammenkobling og protokolspecificering mellem de forskellige lag i applikationen er et resultat af interface specificeringen. Et eksempel p친 dette er r칝kken af view/presenter interfaces beskrevet i underafsnittet om design af applikationens pr칝sentationslag.

Den overordnede ide omkring designet af model-view-presenter er adskillelse af laggene. View kalder presenter, som kan hente data fra model. Opstarts- og et interaktionsscenarie eksemplificeres p친 f칮lgende sekvensdiagram.

\begin{figure}
	\centering
	\includegraphics[width=1.0\linewidth]{figs/design/application_sd}
	\caption{Sekvensdiagram for det generelle interaktionsm칮nster i applikationslaget}
	\label{fig:application_sd}
\end{figure}

\subsection{Applikationens modellag}
I dette afsnit beskrives designet af softwarepakken Smartpool.Application.Model. Modellaget best친r af de klasser der h친ndterer beregninger og verificering af data lokalt, inden data sendes fra applikationslaget til serveren. I modellaget findes ogs친 klasser der gemmer klient-applikationens tilstand i runtime.

Modellaget har til form친l at adskille den f칮rn칝vnte logik fra pr칝sentations- og view-laget, for at overholde applikationslagets overordnede model-view-presenter arkitektur, samt at genbruge rutiner der anvendes af flere forskellige presenters.

\begin{figure}
	\centering
	\includegraphics[width=1.0\linewidth]{figs/design/application_model_cd}
	\caption{Applikationens modellag}
	\label{fig:application_model_cd}
\end{figure}

Af diagrammet fremg친r det at denne softwarepakke best친r af fire klasser. Det bem칝rkes desuden modellen har en afh칝ngighed til Smartpool.Connection.Model, som indeholder den yderligere forbindelsesmodel, der deles af b친de applikationslaget og connection-server laget. I de efterf칮lgende afsnit beskrives de enkelte klassers design.

\subsubsection{Session}

Session er en klasse der skal gemme applikationens tilstand i runtime. Session-klassen blev designet ud fra client-server aspektet af systemets arkitektur, s친ledes at sessionsoplysninger fra serveren kunne lagres midlertidigt i applikationslaget. Session-klassen er designet som en singleton, s친ledes at applikationens tilstand kan persistere mellem overgange til forskellige views og presenters.

I Session-klassen gemmes information modtaget fra serveren (Username og TokenString) efter en forbindelse er blevet oprettet. Derudover gemmes information om hvilken pool brugeren har valgt at interagere med.

\begin{table}
	\centering
	\begin{tabular}{lcr}
		\toprule
		\textbf{Klassemedlem}	& \textbf{Beskrivelse} \\
		\midrule
		+ Pools : List<Tuple<string, bool>>			& En liste med pools. En pool repr칝senteres med navn og notifikationsstatus.		\\
		+ SelectedPool : Tuple<string, bool>			& En property som returnerer den pool som brugeren sidst har valgt at unders칮ge.	\\
		+ SelectedPoolIndex : int					& En integer der tilsvarer den valgte pools index i listen af pools.				\\
		+ SharedSession : Session				& En property der returnere den statiske instans af Session-klassen, eller konstruere den hvis den ikke allerede findes, som f칮lge af Singleton princippet. \\
		+ TokenString : string					& En string indeholdende et token der bruges til kontakt med serveren. \\
		+ Username : string						& En string indeholdende det brugernavn som brugeren af applikationen er logget ind med. \\
		- sharedSession : Session					& Backing variablen til den statiske Singleton Session. \\
		- Session()							& Session-klassens constructor. Den er gjort privat for at sikre Singleton-metoden. \\
		\bottomrule
		\end{tabular}
	\caption{Session klassen}
	\label{tab:table_design_session}	
\end{table}

\subsubsection{PoolLoader}
PoolLoader er en klasse der har til ansvar at indkapsle den logik der omfatter indl칝sning og overf칮ring af pool-data fra client-server forbindelsen, til Session-klassen i applikationslaget. 

PoolLoader-klassen indeholder en r칝kke metoder der g칮r det nemmere for klasser i pr칝sentationslaget at udf칮re f칮rn칝vnte opgaver, s친ledes at pr칝sentationsklasserne der indl칝ser pool-oplysninger kan fral칝gge sig dele af dette ansvar, og fokusere p친 pr칝sentationslogik.

[Tabel mangler]

Mange af metoderne i PoolLoader-klassen tager imod en IClientMessenger. Denne klasse anvendes prim칝rt som interface til klienten i applikationslaget. Med interfacet kan beskeder sendes til serveren. Det er n칮dvendigt da PoolLoader-klassen s칮rger for at sende de forskellige pool-data beskeder til serveren, som kr칝ves for at indhente den forn칮dne data.

\subsubsection{PoolValidator}
PoolValidator er en klasse der indkapsler valideringslogik for klasser i pr칝sentationslaget, der enten har med oprettelse eller modificering af pools at g칮re.

Klassen indeholder de properties som en almindelig pool ogs친 indeholder, samt metoder der kan kaldes for at unders칮ge om klassens properties er sat korrekt, i forhold til det der forventes af en pool i systemet.

[Tabel mangler]

\subsubsection{UserValidator}
UserValidator er en klasse der h친ndterer validering af brugeroprettelse og redigering p친 applikationslaget, inden en foresp칮rgsel af denne type sendes til serveren.

Klassen hj칝lper med at isolere brugervalideringslogik, fra klasser i pr칝sentationslaget som h친ndterer brugerredigering, samt at give pr칝sentationslaget mulighed for at sende feedback opdateringer til view-laget. Dette er ogs친 med til at aflaste serveren, da en foresp칮rgsel med ufuldendte oplysninger ikke kan sendes til validering p친 serveren, mens UserValidator-klassen benyttes.

[Tabel mangler]

\subsection{Applikationens pr칝sentationslag}
I dette afsnit beskrives designet af softwarepakken Smartpool.Application.Presentation. Denne pakke indeholder pr칝sentationslogikken, som indg친r i applikationslager, i det distribuerede system.

I pr칝sentationslaget designes en r칝kke presenter-interfaces. Disse presenters har til form친l at binde model- og view-lag sammen, samt at definere den tilh칮rende pr칝sentationslogik. Konkrete presenter-klasser er ogs친 designet i dette lag. De konkrete klasser implementerer de f칮rn칝vnte interfaces, samt benytter sig af modellen beskrevet i forrige afsnit. Der defineres ogs친 en r칝kke view-interfaces. Disse interfaces benyttes og implementeres af view klasser i de platform-specifikke udgaver af Smartpool applikationen. Interfaces er designet undervejs i projektudviklingsforl칮bet, i takt med at user stories er blevet 친bnet og l칮st.

\subsection{Presenter-interfaces}
Presenter-interfacene definerer en simpel protokol mellem view og presenter. De indeholder metoder som b칮r kaldes af det tilh칮rende view, n친r bestemte events sker i view-laget. Overordnede presenter interfaces er i l칮bet af projektforl칮bet blevet identificeret, og segregeret fra de 칮vrige interfaces.

\begin{figure}
	\centering
	\includegraphics[width=1.0\linewidth]{figs/design/application_presentation_interfaces}
	\caption{Presenter interfaces}
	\label{fig:application_presentation_interfaces}
\end{figure}

I de efterf칮lgende afsnit beskrives designet af de forskellige presenter-interfaces.

\subsubsection{IViewController}
IViewController interfacet er det mest generelle presenter-interface, som implementeres af alle de andre presenter-interfaces. Interfacet indeholder 輹 metode, ViewDidLoad, som kaldes af det tilh칮rende view, efter view?et er loaded i hukommelsen og vises for brugeren.

\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_iviewcontroller}
	\caption{IViewController}
	\label{fig:application_iviewcontroller}
\end{figure}

\subsubsection{IPoolControlling}
IPoolControlling er et interface der er segregeret fra de interfaces som h친ndterer visning og styring af pool oplysninger. Interfacet indeholder 輹 motode, DidSelectPool(int), som b칮r kaldes af det tilh칮rende view, efter en pool er valgt i view?et, fra en liste eller lignende. Integer parameteren repr칝senterer indekset p친 den valgte pool, i listen af pools (se Session).  
\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_ipoolcontrolling}
	\caption{IPoolControlling}
	\label{fig:application_ipoolcontrolling}
\end{figure}

\subsubsection{ISignUpViewController}
Dette interface er designet i forbindelse med user stories, der omhandler, at brugeren skal kunne oprette sig i systemet. Interfacet indeholder metoder, som det tilh칮rende view kan kalde, n친r events som tekst-input sker. Dermed kan presenteren der implementerer dette interface f친 opdateringer fra view?et, n친r brugeren indtaster sine oplysninger.

[Tabel mangler]

\subsubsection{ILoginViewController}
ILoginViewController interfacet implementeres af den presenter, der h친ndterer brugerens loginanmodninger. Interfacet indeholder metoder, som view?et kan kalde, n친r events som tekst-input sker.

[Tabel mangler]

\subsubsection{IAddPoolViewController}
Dette interface er designet i forbindelse med user stories, der omhandler oprettelse af pools, p친 en brugers konto. Interfacet indeholder metoder, som view?et kan kalde, n친r events som tekst-input sker.

[Tabel mangler]

\subsubsection{IEditUserViewController}
Dette interface er designet i forbindelse med user stories, der omhandler redigering af brugeroplysninger. Interfacet er i f칮rste omgang designet ud fra en enkelt user story, der omhandler 칝ndring af brugens password. Interfacet indeholder der metoder, som view?et kan kalde, n친r brugeren indtaster 칮nskede password 칝ndringer.

[Tabel mangler]

\subsubsection{IEditPoolViewController}
IEditPoolViewController interfacet er designet i forbindelse med user stories der omhandler redigering af pools, p친 en brugers konto.

[Tabel mangler]

\subsubsection{IStatViewController og IHistoryViewController}
Disse interfaces er begge en komposition af IViewController og IPoolControlling. Dette virker umiddelbart redundant men skyldes forventet fremtidig funktionalitet, der endnu ikke er en del af de to interfaces. De to interfaces implementeres af presenter-klasser, som udf칮rer user stories omhandlende pr칝sentation af m친ledata for brugeren.

\subsection{View-interfaces}
I dette afsnit beskrives designet af applikationens view-interfaces. Disse interfaces er designet sammen med deres tilh칮rende presenter-interfaces, beskrevet i det foreg친ende afsnit. View-interfacene indeholder metoder som kan opdatere view?ets state, eller videregive notifikationer til view?et.

\begin{figure}
	\centering
	\includegraphics[width=1.0\linewidth]{figs/design/application_view_interfaces}
	\caption{View interfaces}
	\label{fig:application_view_interfaces}
\end{figure}

I de efterf칮lgende afsnit beskrives designet af applikationslagets view-interfaces.

\subsubsection{IView}
Dette interface er det mest generelle view-interface, som implementeres af alle de andre views. Interfacet indeholder 輹 property, Controller, som er en IViewController beskrevet i foreg친ende afsnit. Alle views har derfor en controller, som de kan kalde ViewDidLoad p친, eller typecaste til en mere specifik controller, som passer til det konkrete view.

\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_iview}
	\caption{IView}
	\label{fig:application_iview}
\end{figure}

\subsubsection{IPoolDisplaying}
IPoolDisplaying er et andet generelt interface, som implementeres af alle de andre view-interfaces der har med visning af pool-oplysninger at g칮re. Dette interface er segregeret fra de 칮vrige view-interfaces i forbindelse med projektets udvikling, da flere user stories, og dermed view-designs, indeholdte metoder til visning af pool-oplysninger. Interfacet indeholder metoder, som presenteren kan kalde, for at indl칝se pool-oplysninger i view?et.

\begin{figure}
	\centering
	\includegraphics[width=0.4\linewidth]{figs/design/application_ipooldisplaying}
	\caption{IPoolDisplaying}
	\label{fig:application_ipooldisplaying}
\end{figure}

\subsubsection{IAlertDisplaying}
IAlertDisplaying er det sidste generelle view-interface der er designet i dette lag. Det implementeres af alle de mere specifikke view-interfaces, der b칮r have mulighed for at vise en notifikation for brugeren.

\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_ialertdisplaying}
	\caption{IAlertDisplaying}
	\label{fig:application_ialertdisplaying}
\end{figure}

\subsubsection{ISignUpView}
Dette interface er modparten til ISignUpViewController interfacet. ISignUpView indeholder dermed metoder til at opdatere view?ets tilstand, i form af tekstfelter og statusnotifikationer.

[Tabel mangler]

\subsubsection{ILoginView}
ILoginView er modparten til ILoginViewController interfacet. Dette interface indeholder metoder som presenteren kan kalde, for at opdatere view?et under loginfors칮g. Dette interface omhandler dermed, den user story, hvor en bruger 칮nsker at kunne logge ind i systemet.

[Tabel mangler]

\subsubsection{IAddPoolView}
Dette interface er modparten til IAddPoolViewController. Det indeholder metoder der tilgodeser de user stories, hvor en pool 칮nskes oprettet i systemet.

[Tabel mangler]

\subsubsection{IEditUserView}
IEditUserView interfacet indeholder metoder der kan kaldes af en IEditUserViewController, under redigering af pool-oplysninger.

[Tabel mangler]

\subsubsection{IEditPoolView}
Dette interface er modparten til IEditPoolViewController, og omhandler dermed redigering af pool-oplysninger. Interfacet indeholder en r칝kke metoder til at s칝tte tilstanden i de tekstfelter og knapper der vurderes n칮dvendige i views af denne type.

[Tabel mangler]

\subsubsection{IStatView}
IStatView er modparten til IStatViewController. Dette interface indeholder 輹 metode, der skal kunne indl칝se sensor data i view?et. Sensor data bliver sendt som en liste af tupler, med sensor type og m친lev칝rdi.

\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_istatview}
	\caption{IStatView}
	\label{fig:application_istatview}
\end{figure}

\subsubsection{IHistoryView}
Dette interface er modparten til IHistoryViewController. Interface indeholder 輹 metode, der skal kunne indl칝se historisk sensor data i view?et. Sensor data bliver sendt som en liste af tupler, med sensor type og en liste af m친lev칝rdier.

\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_ihistoryview}
	\caption{IHistoryView}
	\label{fig:application_ihistoryview}
\end{figure}

\subsection{Presenter-klasser}
Efter at have designet par af view- og presenter-interfaces, blev konkrete presenter-klasser designet. De implementerer et presenter-interface, samt indeholder det view-inteface, som presenteren b칮r kobles sammen med.

Presenter-klasserne er designet til at v칝re platform-uafh칝ngige, ved ikke at benytte klasser, som ikke underst칮ttes i portable projekter. Da klasserne er designet sammen med interfaces, giver det stadigv칝k mulighed for, at lave specifikke presenters for en given platform, hvis det bliver n칮dvendigt. Alle presenters har en constructor, der tager imod en IClientMessenger (defineret i connection-modellen), og et view af den tilh칮rende type. Presenter-klasserne har brug for at modtage en IClientMessenger fra view?et der instantiere presenteren, for at platform specifikke klienter ikke skal forhindre pr칝sentationslaget i at v칝re portabelt. 

\begin{figure}
	\centering
	\includegraphics[width=0.8\linewidth]{figs/design/application_presentation_full}
	\caption{Klasser og interfaces i pr칝sentationslaget}
	\label{fig:application_presentation_full}
\end{figure}

I de efterf칮lgende afsnit beskrives kort, de metoder og properties, der er tilf칮jet designet af de konkrete presenters, og som ikke er beskrevet ved deres interface.

\subsubsection{SignUpViewController}
SignUpViewController-klassen implementerer ISignUpViewController interfacet. Klassen indeholder en r칝kke private felter, til at gemme en reference til de parametre der medsendes i constructoren. Derudover indeholder klassen en UserValidator fra modellaget, da denne type presenter har brug for en metode til, at verificere oplysninger ved brugeroprettelse.

\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_signupviewcontroller}
	\caption{SignUpViewController}
	\label{fig:application_signupviewcontroller}
\end{figure}

\subsubsection{LoginViewController}
LoginViewController-klassen implementerer ILoginViewController interfacet. Klassen indeholder en r칝kke private felter, til at gemme en reference til de parametre der medsendes i constructoren. Derudover indeholder klassen en UserValidator, som presenteren kan benytte til verificering af loginoplysninger.

\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_loginviewcontroller}
	\caption{LoginViewController}
	\label{fig:application_loginviewcontroller}
\end{figure}

\subsubsection{AddPoolViewController}
AddPoolViewController-klassen implementerer IAddPoolViewController interfacet. Klassen indeholder en r칝kke private felter, til at gemme en reference til de parametre der medsendes i constructoren. Da denne type presenter if칮lge interfacet h친ndterer tilf칮jelse af nye pools, indeholder klassen ogs친 en PoolValidator fra modellaget, til validering af brugerens input.

\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_addpoolviewcontroller}
	\caption{AddPoolViewController}
	\label{fig:application_addpoolviewcontroller}
\end{figure}

\subsubsection{EditUserViewController}
EditUserViewController-klassen implementerer IEditUserViewController interfacet. Klassen indeholder en r칝kke private felter, til at gemme en reference til de parametre der medsendes i constructoren. Klassen har ogs친 en UserValidator til verificeing af brugeroplysninger.

\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_edituserviewcontroller}
	\caption{EditUserViewController}
	\label{fig:application_edituserviewcontroller}
\end{figure}

\subsubsection{EditPoolViewController}
Denne klasse implementerer IEditPoolViewController interfacet. Ud over de parametre der medsendes i constructoren, indeholder klassen en PoolValidator fra modellaget, samt en PoolLoader. PoolLoaderen er n칮dvendig for presenterens design, da den skal l칮se opgaver omhandlende indhentning af pool-oplysninger.

\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_editpoolviewcontroller}
	\caption{EditPoolViewController}
	\label{fig:application_editpoolviewcontroller}
\end{figure}

\subsubsection{StatViewController og HistoryViewController}
StatViewController og HistoryViewController implementerer hhv. IStatViewController og IHistoryViewController interfacene. Begge presenter-klasser indeholder private felter til at gemme de parametre der modtages i constructoren, samt en PoolLoader, da begge klasser skal kunne indl칝se pool-oplysninger.

\begin{figure}
	\centering
	\includegraphics[width=0.3\linewidth]{figs/design/application_statviewcontroller}
	\caption{StatViewController}
	\label{fig:application_statviewcontroller}
\end{figure}